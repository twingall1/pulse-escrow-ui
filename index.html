<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pulsecrow ‚Äì Trustless Two-Party Escrow on PulseChain</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.1/dist/ethers.min.js"></script>
  <style>
    :root {
      --primary:#0084ff; --bg:#f8fafc; --text:#222;
    }
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      background: var(--bg); color: var(--text);
      max-width: 640px; margin: 40px auto; padding: 24px;
      border-radius: 16px; box-shadow: 0 0 20px rgba(0,0,0,0.08);
    }
    h1,h2 { text-align:center; }
    input,button,select {
      width:100%; padding:10px; margin:6px 0;
      border-radius:8px; border:1px solid #ccc; font-size:15px;
    }
    button {
      background:var(--primary); color:#fff; font-weight:600; border:none; cursor:pointer;
    }
    button:disabled { background:#ccc; cursor:not-allowed; }
    button:hover:enabled { background:#006edc; }
    #statusBox { background:#fff; border:1px solid #ddd; border-radius:8px; padding:10px; margin-top:10px; white-space:pre-wrap; }
    .small { font-size:0.9em; color:#555; }
    .section { margin-top:30px; }
  </style>
</head>
<body>
  <h1>‚ö° Pulsecrow</h1>
  <p style="text-align:center;">
    Trustless two-deposit escrow on <b>PulseChain</b><br>
    0.5 % fee to <code>0xf84b1110f14Bd7D5fEEeE033ABf4Bc24e829A06c</code>
  </p>

  <button id="connectBtn">üîó Connect Wallet</button>
  <div id="walletInfo" class="small"></div>
  <hr/>

  <!-- ============ CREATE ESCROW ============ -->
  <div class="section">
    <h2>Create New Escrow</h2>
    <input id="partyB" placeholder="Counterparty address (Party B)" />
    <input id="tokenA" placeholder="Your token (Token A) address" />
    <input id="tokenB" placeholder="Their token (Token B) address" />
    <input id="amountA" placeholder="Your amount (e.g. 1.5)" />
    <input id="decA" placeholder="Token A decimals (e.g. 18)" />
    <input id="amountB" placeholder="Their amount (e.g. 100)" />
    <input id="decB" placeholder="Token B decimals (e.g. 18)" />
    <input id="deadline" placeholder="Deadline (Unix timestamp)" />
    <button id="createBtn" disabled>Create Escrow</button>
    <div id="newEscrow" class="small"></div>
  </div>

  <!-- ============ JOIN ESCROW ============ -->
  <div class="section">
    <h2>Join Existing Escrow</h2>
    <input id="escrowAddr" placeholder="Paste Escrow Address" />
    <button id="approveBtn" disabled>Approve My Token</button>
    <button id="depositBtn" disabled>Deposit My Token</button>
    <button id="settleBtn" disabled>Settle</button>
    <button id="refundBtn" disabled>Refund</button>
    <div id="statusBox">Status: not connected</div>
  </div>

  <div id="log" class="small"></div>

<script>
const factoryAddress = "0xYOUR_FACTORY_CONTRACT_HERE"; // ‚Üê FILL IN AFTER DEPLOY
const feeWallet = "0xf84b1110f14Bd7D5fEEeE033ABf4Bc24e829A06c";
const feeBps = 50; // 0.5 %
let provider, signer, userAddr;

const factoryABI = [
  "function createEscrow(address,address,address,address,uint256,uint256,uint256) external returns (address)",
  "event EscrowCreated(address indexed creator, address escrowAddress)"
];
const escrowABI = [
  "function depositA() external",
  "function depositB() external",
  "function settle() external",
  "function refundA() external",
  "function refundB() external",
  "function partyA() view returns (address)",
  "function partyB() view returns (address)",
  "function depositedA() view returns (bool)",
  "function depositedB() view returns (bool)"
];

function log(msg){ document.getElementById('log').innerText=msg; console.log(msg); }
function toWei(amount,dec){ return BigInt(Math.round(parseFloat(amount)*10**dec)); }

async function connect(){
  if(!window.ethereum) return alert("Please install MetaMask / Web3 wallet.");
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  userAddr = await signer.getAddress();
  document.getElementById('walletInfo').innerText=`Connected: ${userAddr}`;
  // Enable buttons
  ['createBtn','approveBtn','depositBtn','settleBtn','refundBtn']
    .fo
